USE MALM;

CREATE TABLE PERSON (
	PERSON_ID INT IDENTITY PRIMARY KEY,
	FIRSTNAME VARCHAR(20) NOT NULL,
	LASTNAME VARCHAR(40) NOT NULL,
	BIRTHDAY DATE
	);

CREATE TABLE PRESENCE (
	ID_PERSON INT NOT NULL,
	DIA DATE NOT NULL,
	CONSTRAINT PK_Presence PRIMARY KEY CLUSTERED (ID_PERSON, DIA),
	CONSTRAINT FK_HumanPresence FOREIGN KEY (ID_PERSON) REFERENCES PERSON(PERSON_ID)
	);

INSERT INTO PERSON (FIRSTNAME, LASTNAME) VALUES ('Jimmy', 'Feliber');

INSERT INTO PRESENCE (DIA, ID_PERSON) VALUES ('2015-12-17', 1);

SELECT * FROM PRESENCE WHERE DIA = convert(varchar(30), cast('09/23/2019' as datetime), 102) AND ID_PERSON = 6
IF @@ROWCOUNT = 0
    INSERT INTO PRESENCE(DIA, ID_PERSON) VALUES(convert(varchar(30), cast('09/23/2019' as datetime), 102), 6)

SELECT DIA, DATEDIFF(DAY, '09/23/2019', DIA)+1 AS WEEKDAY FROM (
SELECT DIA
FROM PRESENCE WHERE ID_PERSON = 1 AND DIA BETWEEN CONVERT(VARCHAR(30), CAST('09/23/2019' AS DATETIME), 102)
AND CONVERT(VARCHAR(30), CAST('09/29/2019' AS DATETIME), 102)) AS SUB_QUERY

DELETE FROM PRESENCE WHERE DIA = CONVERT(VARCHAR(30), CAST('09/26/2019' AS DATETIME), 102) AND ID_PERSON = 1;

SELECT * FROM PERSON;

SELECT * FROM Presence;

DELETE FROM PERSON WHERE FIRSTNAME = 'JULIE'

DROP TABLE PERSON;

DROP TABLE Presence;

SELECT PERSON_ID, (1-PERSON_ID) FROM PERSON;